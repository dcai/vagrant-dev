---
- hosts: all
  become: True
  become_method: sudo
  become_user: root
  remote_user: ubuntu
  vars:
    httpd_user: www-data
    httpd_group: www-data
    php_version: 7.1
  tasks:
    - name: set timezone to Etc/UTC
      timezone:
        name: Etc/UTC
    - include: tasks/php.yml
    - include: tasks/nginx.yml
    - include: tasks/user.yml
    - include: tasks/packages.yml
    - include: tasks/mysql.yml
    # - include: tasks/efs.yml
    # - include: tasks/java.yml
    # - include: tasks/vagrant.yml
    # - include: tasks/apache.yml
    # - include: tasks/moodle.yml

  handlers:
    - name: restart nginx
      service: name=nginx state=restarted
    - name: restart php-fpm
      service: name=php{{ php_version }}-fpm state=restarted
    - name: restart mysql
      service: name=mysql state=restarted
